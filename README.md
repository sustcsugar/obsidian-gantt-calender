# Obsidian Gantt Calendar 插件

一个强大的 Obsidian 任务管理和日历插件，提供多种视图模式和双格式任务支持。

## ✨ 功能特性

### 📅 多种日历视图
- **年视图**：全年任务概览，支持任务数量显示和热力图可视化
- **月视图**：月度日历，清晰显示每日任务，支持任务列表弹窗
- **周视图**：周计划视图，精细安排每周工作
- **日视图**：单日详细视图，支持 Daily Note 集成和任务列表
- **农历支持**：显示农历日期、阳历节日、农历节日和节气

### ✅ 任务管理
- **任务列表视图**：专门的任务管理界面，集中管理所有任务
- **全局筛选**：自定义任务标记（如 🎯），快速筛选特定任务
- **双格式支持**：兼容 Tasks 插件（emoji格式）和 Dataview 插件（字段格式）
- **完整任务属性**：
  - 优先级：6个等级（highest, high, medium, normal, low, lowest）
  - 6种时间属性：创建日期、开始日期、计划日期、截止日期、取消日期、完成日期
- **智能筛选**：支持全部/未完成/已完成任务筛选
- **快速跳转**：点击任务直接跳转到源文件位置
- **实时更新**：文件变更自动更新任务缓存

### 📊 数据可视化
- **年视图热力图**：根据任务数量显示颜色深浅
  - 8种配色方案：蓝、绿、红、紫、橙、青、粉、黄
  - 5级梯度显示任务密度
- **任务数量统计**：年视图可选显示每日任务总数
- **优先级图标**：彩色圆圈直观展示任务优先级

### 🎨 友好界面
- **视图切换**：工具栏一键切换日历视图和任务视图
- **灵活导航**：年月周日之间快速切换
- **响应式设计**：适配不同屏幕尺寸
- **自定义主题**：支持节日颜色、热力图配色自定义


## 🎯 使用场景

### 项目管理
- 使用年视图规划全年项目里程碑
- 热力图快速识别任务密集时段
- 优先级标记确保重要任务不遗漏

### 日常任务跟踪
- 月视图管理月度计划
- 周视图安排每周工作
- 日视图结合 Daily Note 记录每日进展

### 时间管理
- 多种日期属性灵活标记任务时间线
- 截止日期自动高亮逾期任务
- 任务筛选快速查看待办事项


## 快速开始

### 安装插件

1. 打开 Obsidian 设置
2. 进入"社区插件"
3. 搜索"Gantt Calendar"
4. 点击安装并启用

### 打开视图

**方法 1：命令面板**
1. 按 `Ctrl/Cmd + P` 打开命令面板
2. 输入"打开日历视图"或"打开任务视图"
3. 选择对应命令

**方法 2：视图切换**
- 在日历视图中，点击工具栏左侧的"Tasks"按钮切换到任务视图
- 在任务视图中，点击"Calendar"按钮切换回日历视图


## 界面布局

### 工具栏布局

插件主页顶部为工具条（toolbar），分为三个区域：左/中/右。

- 左侧：视图选择区（选择 Calendar 或 Tasks 视图）。
- 中间：显示区（展示当前日期范围或标题；在日视图可附加农历/节日信息）。
- 右侧：功能区（随视图变化）。
  - 在 Calendar 视图：显示上一期、今天、下一期导航按钮。
  - 在 Tasks 视图：显示筛选按钮（全部/未完成/已完成）、全局筛选状态文本（Global Filter: ...）、刷新任务按钮。


## 任务列表视图

任务列表采用卡片式布局，清晰展示每个任务的所有关键信息。

### 任务筛选

任务列表顶部提供三种筛选选项：
- **全部**：显示所有任务（默认）
- **未完成**：仅显示未完成的任务
- **已完成**：仅显示已完成的任务

当前活跃的筛选按钮会高亮显示。

### 任务卡片结构

**第一行：任务基本信息**
- ☐ 复选框：任务完成状态
- 任务描述：任务内容文本
- 优先级图标：右侧显示优先级圆圈

**第二行：时间属性**（如果存在）
- 创建：任务创建日期
- 开始：任务开始日期
- 计划：计划执行日期
- 截止：任务截止日期（逾期任务显示为红色）
- 取消：任务取消日期
- 完成：任务完成日期

**第三行：任务位置**
- 显示任务所在的文件名和行号

### 任务交互

- **点击任务**：跳转到任务所在文件的具体位置
- **优先级显示**：使用彩色圆圈图标
  - 🔴 highest（最高优先级）
  - 🟠 high（高优先级）
  - 🟡 medium（中优先级）
  - ⚪ normal（普通优先级）
  - 🟢 low（低优先级）
  - 🔵 lowest（最低优先级）
- **视觉反馈**：
  - 已完成任务显示为半透明，左边框为绿色
  - 待完成任务左边框为橙色
  - 悬停时略微向右平移
  - 逾期的截止日期显示为红色警告色


## 任务格式详解

本插件兼容两种主流任务格式：Tasks 插件格式和 Dataview 插件格式。

### Tasks 插件格式（基于 Emoji）

使用表情符号标记任务属性：

```markdown
- [ ] 🎯 完成项目文档 ⏫ ➕ 2025-01-10 🛫 2025-01-11 ⏳ 2025-01-12 📅 2025-01-15
```

**Emoji 标记说明**：
- `🎯` - 全局任务标记（可自定义）
- 优先级 emoji（6个级别）：
  - `🔺` - Highest（最高优先级）
  - `⏫` - High（高优先级）
  - `🔼` - Medium（中优先级）
  - 无emoji - Normal（普通优先级）
  - `🔽` - Low（低优先级）
  - `⏬` - Lowest（最低优先级）
- `➕ [date]` - 创建日期
- `🛫 [date]` - 开始日期
- `⏳ [date]` - 计划日期
- `📅 [date]` - 截止日期
- `❌ [date]` - 取消日期
- `✅ [date]` - 完成日期

### Dataview 插件格式（基于字段）

使用字段标记任务属性：

```markdown
- [ ] 🎯 完成项目文档 [priority:: high] [created:: 2025-01-10] [start:: 2025-01-11] [scheduled:: 2025-01-12] [due:: 2025-01-15]
```

**字段标记说明**：
- 优先级字段（6个级别）：
  - `[priority:: highest]` - 最高优先级
  - `[priority:: high]` - 高优先级
  - `[priority:: medium]` - 中优先级
  - 无字段 - 普通优先级（normal）
  - `[priority:: low]` - 低优先级
  - `[priority:: lowest]` - 最低优先级
- `[created:: date]` - 创建日期
- `[start:: date]` - 开始日期
- `[scheduled:: date]` - 计划日期
- `[due:: date]` - 截止日期
- `[cancelled:: date]` - 取消日期
- `[completion:: date]` - 完成日期

### 任务属性详解

#### 1. 全局筛选标记（globalFilter）
- **用途**：用于全局筛选任务
- **位置**：必须在任务行开头（复选框之后）
- **示例**：`- [ ] 🎯 任务内容`
- **匹配规则**：仅匹配任务开头，不搜索全文

#### 2. 任务描述（content）
- **用途**：描述任务的具体内容
- **格式**：纯文本，所有属性标记会被自动清理
- **显示**：与全局标记一起显示在"任务描述"列

#### 3. 优先级（priority）
- **取值**：`highest`、`high`、`medium`、`normal`、`low`、`lowest`
- **Tasks 格式**：使用 emoji 表示
  - `🔺` - Highest
  - `⏫` - High
  - `🔼` - Medium
  - 无 emoji - Normal
  - `🔽` - Low
  - `⏬` - Lowest
- **Dataview 格式**：使用字段表示
  - `[priority:: highest/high/medium/low/lowest]`
  - 无字段表示 Normal
- **显示**：使用彩色圆圈图标
  - 🔴 highest（最高）
  - 🟠 high（高）
  - 🟡 medium（中）
  - ⚪ normal（普通）
  - 🟢 low（低）
  - 🔵 lowest（最低）

#### 4. 时间属性
所有时间属性均为可选，日期格式为 `YYYY-MM-DD`：

- **创建日期（created）**：任务创建时间
- **开始日期（start）**：任务开始时间
- **计划日期（scheduled）**：计划执行时间
- **截止日期（due）**：任务截止时间
- **取消日期（cancelled）**：任务取消时间
- **完成日期（completion）**：任务完成时间



## ⚙️ 插件设置

打开 Obsidian 设置 → Gantt Calendar 插件，可配置：

### 日历视图设置
- **年视图农历字号**：调整年视图月卡片内农历文字大小（8-18px）
- **一周开始于**：选择周一或周日作为一周开始
- **节日颜色设置**：
  - 阳历节日颜色（默认红色 #e74c3c）
  - 农历节日颜色（默认橙色 #e8a041）
  - 节气颜色（默认绿色 #52c41a）
  - 提供7种预设颜色色卡快速选择

### 日视图设置
- **显示 Daily Note**：是否在日视图中显示当天的 Daily Note 内容
- **日视图布局**：
  - 左右分屏（任务在左，笔记在右）
  - 上下分屏（任务在上，笔记在下）
- **Daily Note 文件夹路径**：指定 Daily Note 文件存放位置（默认 DailyNotes）
- **Daily Note 文件名格式**：自定义文件名格式（默认 yyyy-MM-dd）

### 月视图设置
- **每天显示的任务数量**：设置月视图中每个日期卡片最多显示多少个任务（1-10，默认5）

### 年视图设置
- **显示每日任务数量**：在年视图每个日期下方显示当天任务总数
- **启用任务热力图**：根据当天任务数量深浅显示日期背景颜色
- **热力图配色方案**：8种预设配色可选
  - 蓝色、绿色、红色、紫色、橙色、青色、粉色、黄色
  - 每种配色包含5级梯度
  - 平铺色卡直观预览

### 任务视图设置
- **全局任务筛选标记**：定义全局任务标记，只有包含此标记的任务才会被识别
  - 示例：设置为 `🎯 `，则只识别以 `- [ ] 🎯` 开头的任务
  - 默认值：`🎯 `
- **启用的任务格式**：
  - Tasks 插件格式（使用 emoji 表示日期）
  - Dataview 插件格式（使用字段表示日期）
  - 两者都支持（默认）
- **任务文本显示 Global Filter**：是否在任务列表中显示全局筛选前缀
- **日期筛选字段**：选择用于日期范围筛选的日期字段
  - 创建日期、开始日期、计划日期、截止日期、完成日期、取消日期



## 🚀 性能优化

- **全局任务缓存**：避免重复扫描文件，提升渲染速度
- **增量更新**：文件变更时仅更新受影响的任务
- **延迟加载**：启动时等待 vault 就绪后再扫描任务
- **防抖处理**：设置变更时智能刷新视图

## ❓ 常见问题

### 任务不显示？
1. 检查全局筛选标记是否正确
2. 确认任务格式是否符合 Tasks 或 Dataview 规范
3. 查看插件设置中启用的任务格式

### 热力图颜色不显示？
1. 确保"启用任务热力图"开关已打开
2. 刷新年视图或重新加载插件
3. 检查主题是否与热力图样式冲突

### Daily Note 无法显示？
1. 确认 Daily Note 文件夹路径正确
2. 检查文件名格式是否匹配
3. 确保"显示 Daily Note"开关已启用

## 📝 更新日志

### v1.0.0（当前版本）
- ✅ 支持 Tasks 和 Dataview 双格式任务解析
- ✅ 完整的任务属性支持（6个优先级 + 6种时间属性）
- ✅ 年视图任务热力图和数量统计
- ✅ 8种热力图配色方案（平铺色卡选择）
- ✅ Daily Note 集成（支持水平/垂直布局）
- ✅ 农历、节日、节气显示
- ✅ 全局任务缓存和增量更新
- ✅ 任务列表视图集成到日历
- ✅ 工具栏三区域布局
- ✅ 全局筛选支持开头匹配
- ✅ 自定义节日颜色配置



## 开发构建

### 环境要求
- Node.js 18+
- npm

### 安装依赖
```bash
npm install
```

### 开发模式（热重载）
```bash
npm run dev
```

### 生产构建
```bash
npm run build
```

### 测试安装
将 `main.js`、`manifest.json`、`styles.css` 复制到：
```
<你的库>/.obsidian/plugins/obsidian-gantt-calendar/
```

## 技术栈

- TypeScript
- Obsidian API
- esbuild（构建工具）
- 农历库（lunar.ts）


## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 开发指南
1. Fork 本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

📖 详细开发文档请参考 [AGENTS.md](AGENTS.md)

## 📄 许可证

MIT License

💡 如有问题或建议，欢迎提交 [Issue](https://github.com/your-repo/obsidian-gantt-calendar/issues)
