# Obsidian Gantt Calendar

<div align="center" style="padding: 20px; border: 2px solid #8b5cf6; border-radius: 12px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%); margin: 20px 0;">

📅 一个强大的 Obsidian 任务管理和日历插件 ✨
集成日历视图与任务列表 📋 支持农历节日 🏮 任务热力图 🔥
Daily Note 联动 📝 兼容 Tasks 和 Dataview 双格式 🔗

</div>

---

## ✨ 功能特性

🗓️ **多视图日历** - 年/月/周/日/甘特图五种视图自由切换，支持农历节日节气显示
✅ **智能任务管理** - 全局筛选、优先级标记、6种时间属性、实时缓存更新
📊 **数据可视化** - 任务热力图、数量统计、8种配色方案
🔗 **双格式兼容** - 完美支持 Tasks 插件（emoji）与 Dataview 插件（字段）格式
📝 **Daily Note 集成** - 日视图支持显示当天笔记，水平/垂直布局可选
🎨 **高度可定制** - 节日颜色、热力图配色、任务显示数量等全面配置


## 🚀 快速开始

### 安装插件

#### 方法一：社区插件商店（推荐）
1. 打开 Obsidian 设置
2. 进入 **社区插件** → 浏览
3. 搜索 **"Gantt Calendar"**
4. 点击安装并启用

#### 方法二：手动安装
1. 下载最新的 [Release](https://github.com/sustcsugar/obsidian-gantt-calendar/releases)
2. 解压后将文件夹复制到 `<你的库>/.obsidian/plugins/`
3. 重启 Obsidian 并在设置中启用插件

### 打开视图

**命令面板（推荐）**
- `Ctrl/Cmd + P` → 输入 "打开日历视图" 或 "打开任务视图"

**视图切换**
- 在工具栏左侧点击 **Calendar** / **Tasks** 按钮快速切换

### 创建第一个任务

在任何 Markdown 文件中输入：
```markdown
- [ ] 🎯 完成项目文档 📅 2025-12-20
```

刷新插件即可在日历和任务列表中看到该任务！


## 📋 主要功能

### 界面布局

插件采用顶部工具栏 + 内容区的布局结构：

**工具栏（Toolbar）** - 分为左/中/右三个区域：
- **左侧**：视图切换（Calendar ↔ Tasks）
- **中间**：当前日期范围/标题显示（日视图显示农历节日）
- **右侧**：功能按钮
  - Calendar 视图：上一期 | 今天 | 下一期
  - Tasks 视图：全部/未完成/已完成 | 筛选状态 | 刷新

---

### 任务视图

#### 任务筛选
- **完成状态筛选**：全部 / 未完成 / 已完成（活跃按钮高亮）
- **全局标记筛选**：仅显示包含指定前缀的任务（如 `🎯 `）
- **刷新按钮**：手动重新加载任务缓存

#### 任务卡片显示
每个任务以卡片形式展示，包含三行信息：

**第一行** - 基本信息
```
☐ 复选框  任务描述  🔴 优先级
```

**第二行** - 时间属性（存在时显示）
```
创建: 2025-01-10 | 开始: 2025-01-11 | 截止: 2025-01-15
```

**第三行** - 任务位置
```
📄 文件名.md:42
```

#### 任务交互
- **点击任务** → 跳转到源文件位置
- **右键任务** → 打开上下文菜单（编辑任务、创建任务笔记等）
- **优先级颜色**：
  - 🔴 highest | 🟠 high | 🟡 medium
  - ⚪ normal | 🟢 low | 🔵 lowest
- **视觉反馈**：
  - 已完成：半透明 + 绿色左边框
  - 待完成：橙色左边框
  - 逾期截止日期：红色警告
  - 悬停：卡片右移动画

#### 任务格式

**Tasks 插件格式（Emoji）**
```markdown
- [ ] 🎯 完成项目文档 ⏫ ➕ 2025-01-10 📅 2025-01-15
```

| Emoji | 含义 | Emoji | 含义 |
|-------|------|-------|------|
| `🎯` | 全局标记 | `🔺` | 最高优先级 |
| `⏫` | 高优先级 | `🔼` | 中优先级 |
| `🔽` | 低优先级 | `⏬` | 最低优先级 |
| `➕` | 创建日期 | `🛫` | 开始日期 |
| `⏳` | 计划日期 | `📅` | 截止日期 |
| `✅` | 完成日期 | `❌` | 取消日期 |

**Dataview 插件格式（字段）**
```markdown
- [ ] 🎯 完成项目文档 [priority:: high] [created:: 2025-01-10] [due:: 2025-01-15]
```

| 字段 | 含义 | 字段 | 含义 |
|------|------|------|------|
| `priority::` | 优先级 | `created::` | 创建日期 |
| `start::` | 开始日期 | `scheduled::` | 计划日期 |
| `due::` | 截止日期 | `completion::` | 完成日期 |
| `cancelled::` | 取消日期 | - | - |

**任务属性说明**
1. **全局筛选标记**：必须在复选框后开头位置，用于筛选特定任务
2. **任务描述**：纯文本内容，属性标记会自动清理
3. **优先级**：6 个等级（highest/high/medium/normal/low/lowest）
4. **时间属性**：6 种可选日期（格式 `YYYY-MM-DD`）

---

### 日历视图

#### 年视图
- **全年概览**：12 个月卡片展示全年任务分布
- **任务热力图**：5 级颜色梯度，直观显示任务密度
  - 8 种配色方案：蓝/绿/红/紫/橙/青/粉/黄
- **任务数量统计**：可选显示每日任务总数
- **农历显示**：月卡片内显示农历日期
- **点击交互**：点击日期切换到日视图

#### 月视图
- **月度日历**：标准月历布局，清晰显示每日任务
- **任务列表**：每天显示指定数量的任务（可配置 1-10 个）
- **任务弹窗**：点击日期显示当天完整任务列表
- **节日显示**：阳历节日、农历节日、节气三色标记
- **周起始配置**：支持周一/周日开始

#### 周视图
- **周计划视图**：横向展示一周 7 天
- **每日任务列表**：显示每天的所有任务
- **今日高亮**：当天日期特殊标记
- **灵活导航**：上一周/本周/下一周快速切换

#### 日视图
- **详细任务列表**：显示当天所有任务详情
- **Daily Note 集成**：
  - 支持显示当天笔记内容
  - 水平布局（左右分屏）：任务在左，笔记在右
  - 垂直布局（上下分屏）：任务在上，笔记在下
- **农历信息栏**：显示农历日期、节日、节气
- **任务跳转**：点击任务直接定位到源文件

#### 甘特图视图
- **时间线可视化**：横向时间轴展示任务时间跨度
- **时间颗粒度切换**：支持日/周/月/年四种时间刻度
- **任务筛选**：按完成状态和优先级筛选
- **颜色标识**：优先级和状态通过颜色区分



## ⚙️ 插件设置

打开 **Obsidian 设置** → **Gantt Calendar** 进行配置：

### 任务视图设置

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| **全局任务筛选标记** | 定义任务前缀（如 `🎯 `），仅识别包含此标记的任务 | `🎯 ` |
| **启用的任务格式** | Tasks 插件格式 / Dataview 插件格式 / 两者都支持 | 两者都支持 |
| **任务文本显示 Global Filter** | 是否在任务列表中显示全局筛选前缀 | 是 |
| **日期筛选字段** | 用于日期范围筛选的字段（创建/开始/计划/截止/完成/取消） | 截止日期 |

### 日历视图设置

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| **一周开始于** | 周一 / 周日 | 周一 |
| **年视图农历字号** | 调整年视图月卡片内农历文字大小 | 10px（范围 8-18） |
| **节日颜色设置** | 阳历节日/农历节日/节气颜色自定义（含 7 种预设色卡） | 红/橙/绿 |

### 日视图设置

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| **显示 Daily Note** | 是否在日视图中显示当天笔记内容 | 是 |
| **日视图布局** | 左右分屏（任务左笔记右）/ 上下分屏（任务上笔记下） | 左右分屏 |
| **Daily Note 文件夹路径** | 指定 Daily Note 文件存放位置 | DailyNotes |
| **Daily Note 文件名格式** | 自定义文件名格式 | yyyy-MM-dd |

### 月视图设置

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| **每天显示的任务数量** | 月视图日期卡片最多显示任务数 | 5（范围 1-10） |

### 年视图设置

| 设置项 | 说明 | 默认值 |
|--------|------|--------|
| **显示每日任务数量** | 在日期下方显示当天任务总数 | 是 |
| **启用任务热力图** | 根据任务数量深浅显示日期背景颜色 | 是 |
| **热力图配色方案** | 8 种预设配色（蓝/绿/红/紫/橙/青/粉/黄），5 级梯度 | 蓝色 |



---

## 📅 开发计划

### ✅ 已完成（v1.0.0）
- ✅ 支持 Tasks 和 Dataview 双格式任务解析
- ✅ 完整的任务属性支持（6个优先级 + 6种时间属性）
- ✅ 年视图任务热力图和数量统计
- ✅ 8种热力图配色方案（平铺色卡选择）
- ✅ Daily Note 集成（支持水平/垂直布局）
- ✅ 农历、节日、节气显示
- ✅ 全局任务缓存和增量更新
- ✅ 任务列表视图集成到日历
- ✅ 工具栏三区域布局
- ✅ 全局筛选支持开头匹配
- ✅ 自定义节日颜色配置

### ✅ 已完成（v1.1.0）
- ✅ 任务右键菜单（编辑任务、创建任务笔记）
- ✅ 任务复选框功能（支持完成状态切换）
- ✅ 两种任务格式均支持复选框
- ✅ 甘特图视图（时间线可视化）
- ✅ 任务属性批量编辑模态框
- ✅ 代码结构重组优化

### 🔜 计划中（v1.2.0）
- [ ] 任务解析增强
    - [ ] Tasks 格式跨行任务解析
    - [ ] 子任务解析
    - [ ] 任务描述中超链接与双链渲染
    - [ ] 不规范任务格式警告提示
- [ ] 任务视图增强
    - [ ] 任务排序功能（按优先级/日期/文件名）
    - [ ] 批量任务操作
    - [ ] 任务统计看板（完成率/逾期任务统计）
- [ ] 日历视图交互
    - [ ] 拖动任务修改日期
    - [ ] 日视图嵌入 Daily Note 样式优化

### 💡 未来计划（v2.0.0）
- [ ] 移动端适配优化
- [ ] 订阅第三方日历
- [ ] 任务模板功能
- [ ] 周期性任务（每日/每周/每月重复）
- [ ] 任务导出（导出为 CSV/JSON）
- [ ] 与 Obsidian Projects 插件集成
- [ ] 自定义视图布局（拖拽调整）

### 现有 bug list
- ✅ 日历视图的任务悬浮卡片，有概率会不消失
    - ✅ 打开插件的情况下，如果点击刷新按钮重新解析任务，会大概率导致悬浮窗问题
- ✅ 刷新按钮，在打开插件的情况下，点击刷新按钮会造成严重的卡顿
- [ ] 任务卡片右键菜单
    - ✅ 编辑任务的
    - [ ] 创建别名笔记



---

## 🛠️ 开发构建

### 环境要求
- **Node.js**：18+ LTS
- **包管理器**：npm
- **打包工具**：esbuild

### 安装依赖
```bash
npm install
```

### 开发模式
启动热重载监听（修改代码自动编译）：
```bash
npm run dev
```

### 生产构建
编译生成 `main.js`：
```bash
npm run build
```

### 测试安装
将以下文件复制到插件目录：
```
<你的库>/.obsidian/plugins/obsidian-gantt-calendar/
├── main.js
├── manifest.json
└── styles.css
```

然后在 Obsidian 中重新加载插件。

### 技术栈
- **TypeScript** - 主要开发语言
- **Obsidian API** - 插件核心框架
- **esbuild** - 高速打包工具
- **lunar.ts** - 农历计算库

### 项目结构
```
src/
├── CalendarView.ts          # 主视图容器，管理所有子视图
├── calendarGenerator.ts     # 日历数据生成（月历）
├── calendarUtils.ts         # 日历工具统一导出
├── taskManager.ts           # 任务缓存管理器（单例模式）
├── settings.ts              # 插件设置面板
├── types.ts                 # TypeScript 类型定义
│
├── calendar/                # 日历相关模块
│   ├── calendarGenerator.ts # 月历数据生成
│   └── calendarIndex.ts     # 统一导出
│
├── dateUtils/               # 日期工具模块
│   ├── dateCompare.ts       # 日期比较（isToday, isThisMonth）
│   ├── format.ts            # 日期格式化
│   ├── today.ts             # 获取今天日期
│   ├── week.ts              # 周相关工具
│   └── dateUtilsIndex.ts    # 统一导出
│
├── utils/                   # 通用工具模块
│   ├── fileOpener.ts        # 文件打开工具
│   └── index.ts             # 统一导出
│
├── lunar/                   # 农历计算模块
│   ├── lunar.ts             # 农历转换核心
│   ├── lunarConvert.ts      # 阴阳历转换
│   ├── lunarData.ts         # 农历数据
│   ├── festival.ts          # 节日计算
│   ├── solarTerm.ts         # 节气计算
│   └── lunarUtils.ts        # 工具函数
│
├── tasks/                   # 任务处理模块
│   ├── taskParser.ts        # 任务解析（Tasks + Dataview）
│   ├── taskSearch.ts        # 任务搜索筛选
│   ├── taskUtils.ts         # 任务工具函数
│   └── taskUpdater.ts       # 任务属性更新
│
├── views/                   # 视图渲染器
│   ├── BaseCalendarRenderer.ts  # 基类，共享方法
│   ├── YearView.ts          # 年视图
│   ├── MonthView.ts         # 月视图
│   ├── WeekView.ts          # 周视图
│   ├── DayView.ts           # 日视图
│   ├── TaskView.ts          # 任务列表视图
│   └── GanttView.ts         # 甘特图视图
│
├── toolbar/                 # 工具栏模块
│   ├── toolbar.ts           # 工具栏容器
│   ├── toolbar-left.ts      # 左侧（视图切换）
│   ├── toolbar-center.ts    # 中间（日期显示）
│   ├── toolbar-right-calendar.ts  # 右侧（日历导航）
│   ├── toolbar-right-task.ts      # 右侧（任务筛选）
│   ├── toolbar-right-gantt.ts     # 右侧（甘特图控制）
│   ├── time-granularity.ts  # 时间颗粒度选择
│   ├── status-filter.ts     # 状态筛选
│   └── refresh-button.ts    # 刷新按钮
│
├── commands/                # 命令模块
│   ├── common.ts            # 通用命令
│   ├── editor.ts            # 编辑器命令
│   ├── conditional.ts       # 条件命令
│   └── commandsIndex.ts     # 统一导出
│
└── contextMenu/             # 右键菜单模块
    ├── contextMenuIndex.ts  # 统一导出
    └── commands/            # 菜单命令
        ├── editTask.ts      # 编辑任务
        ├── createNoteFromTask.ts     # 创建任务笔记（同名）
        ├── createNoteFromTaskAlias.ts # 创建任务笔记（别名）
        └── cancelTask.ts    # 取消任务
```

### 贡献指南
欢迎提交 Issue 和 Pull Request！

1. Fork 本项目
2. 创建特性分支：`git checkout -b feature/AmazingFeature`
3. 提交更改：`git commit -m 'Add some AmazingFeature'`
4. 推送到分支：`git push origin feature/AmazingFeature`
5. 提交 Pull Request

---

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

---

<div align="center">

💡 **遇到问题或有建议？** 欢迎提交 [Issue](https://github.com/sustcsugar/obsidian-gantt-calendar/issues)

⭐ **喜欢这个插件？** 请给我们一个 Star！

</div>
